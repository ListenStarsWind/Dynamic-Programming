# [解码方法 II](https://leetcode.cn/problems/decode-ways-ii/)

![image-20250603112135321](https://md-wind.oss-cn-nanjing.aliyuncs.com/md/20250603112135498.png)

## 算法原理

略, 看代码注释

## 代码编写

```cpp
/*
    为了方便起见, 和解码方法一一样, 最开始, 我们在最前面增加一个虚拟位置, 初始化为1, 毕竟, 空
    字符串也是一样解码方法.接着, 我们可以定义dp[i]表示对字符串[i-1]位置进行解码, 出的解码数
    
    如果[i-1]位置是'*', 那么首先将它作为一位便可以解出9种方案, 之前的解码方案是dp[i-1]现在
    dp[i-1]中的每一种都搭配9种方案, 所以dp[i] += dp[i-1] * 9;接着可以把他当做两位来看, 
    此时前缀的搭配种数就是dp[i-2], 当前一个字符是一时, 有11~19共9种搭配 dp[i-2] * 9如果
    前面的字符是2, 那么只有21~26共6种搭配dp[i-2] * 9;如果前面的字符是*,l 那么只有11~26共
    15种搭配dp[i-2] * 15;
    
    当[i-1]位置是正常数字时, 首先, 当把他作为一位来解码时, 就是在前缀的基础上加上一个固定
    字符, 所以是dp[i] += dp[i-1]把他当做两位来进行解码时, 首先前缀有dp[i-2]种方案, 当
    [i-2]不是*时, 只要这个两位数在10~26都可以进行合法解码, 解码出一个字符这个字符接在
    dp[i-2]后面, 所以是dp[i] += dp[i-2]当[i-2]是*时, 当[i-1]小于等于6是, 记作x就有1x, 
    2x两种搭配, dp[i-2] * 2;当[i-1]比6大, 就只有1x这一种, dp[i-2]

    最开始使用uint32_t, 发现一个九位数乘以九还是九位数, 遂改为uint64_t
*/

class Solution {
public:
    int numDecodings(string s) {
        if(s.front() == '0') return 0;
        
        const uint64_t MOD = 1e9 + 7;
        uint64_t dp[100001] = {0};
        dp[0] = 1;
        dp[1] = s[0] == '*' ? 9 : 1;
        
        int n = s.size();
        for(int i = 2; i <= n; ++i)
        {
            if(s[i-1] == '*')
            {
                dp[i] = dp[i-1] * 9;
                if(s[i-2] == '1') dp[i] += dp[i-2] * 9;
                else if(s[i-2] == '2') dp[i] += dp[i-2] * 6;
                else if(s[i-2] == '*') dp[i] += dp[i-2] * 15;
            }
            else
            {
                if(s[i-1] != '0') dp[i] += dp[i-1];
                if(s[i-2] != '*')
                {
                    int temp = (s[i-2] - '0') * 10 + (s[i-1] - '0');
                    if(temp >= 10 && temp <= 26) dp[i] += dp[i-2];
                }
                else
                {
                    if(s[i-1] <= '6') dp[i] += dp[i-2] * 2;
                    else dp[i] += dp[i-2];
                }
            }
            dp[i] %= MOD;
        }

        return dp[n];
    }
};
```

# 完

